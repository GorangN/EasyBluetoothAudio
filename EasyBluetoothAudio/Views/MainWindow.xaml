<Window x:Class="EasyBluetoothAudio.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:EasyBluetoothAudio"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        xmlns:views="clr-namespace:EasyBluetoothAudio.Views"
        mc:Ignorable="d"
        Title="EasyBluetoothAudio" Height="350" Width="500"
        ResizeMode="NoResize"
        ShowInTaskbar="False"
        Visibility="Hidden"
        WindowStartupLocation="Manual"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Icon="/Assets/EasyBluetoothAudio.ico">

    <Grid Background="{StaticResource DeepBlackBrush}">
        <Border Background="{StaticResource DiagonalStripeBrush}" IsHitTestVisible="False"/>

        <tb:TaskbarIcon x:Name="TrayIcon"
                        IconSource="/Assets/EasyBluetoothAudio.ico"
                        ToolTipText="Easy Bluetooth Audio"
                        LeftClickCommand="{Binding OpenCommand}"
                        DoubleClickCommand="{Binding OpenCommand}">
            <tb:TaskbarIcon.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="Open" Command="{Binding OpenCommand}" />
                    <MenuItem Header="Exit" Command="{Binding ExitCommand}" />
                </ContextMenu>
            </tb:TaskbarIcon.ContextMenu>
        </tb:TaskbarIcon>

        <DockPanel Margin="20">
            <!-- Header Section -->
            <Grid DockPanel.Dock="Top" Margin="0,0,0,20">
                <StackPanel Orientation="Horizontal">
                    <Border Background="{StaticResource AcidYellowBrush}" Width="4" Height="24" Margin="0,0,10,0"/>
                    <TextBlock Text="AUDIO SINK"
                               Foreground="{StaticResource TextWhiteBrush}"
                               FontSize="18" FontWeight="Bold"
                               VerticalAlignment="Center"
                               FontFamily="Consolas"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="&#xE72C;" ToolTip="Refresh Devices"
                            Command="{Binding RefreshCommand}"
                            Style="{StaticResource IconButtonStyle}"
                            Margin="0,0,15,0"/>
                    <Button Content="&#xE713;" ToolTip="Settings"
                            Command="{Binding OpenSettingsCommand}"
                            Style="{StaticResource IconButtonStyle}"/>
                </StackPanel>
            </Grid>

            <!-- Bottom Info & Pattern Decor -->
            <Grid DockPanel.Dock="Bottom" Margin="0,15,0,0">
                <TextBlock Text="{Binding AppVersion, FallbackValue=v.1.0.0}"
                           Foreground="{StaticResource DarkerGreyBrush}"
                           FontSize="12"
                           FontFamily="Consolas"
                           VerticalAlignment="Center"/>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <Rectangle Width="20" Height="10" Fill="{StaticResource AcidYellowBrush}" Margin="5,0"/>
                    <Rectangle Width="10" Height="10" Fill="{StaticResource DarkerGreyBrush}" Margin="5,0"/>
                    <Rectangle Width="5" Height="10" Fill="{StaticResource DarkerGreyBrush}" Margin="5,0"/>
                </StackPanel>
            </Grid>

            <!-- Main Content Area (Main view + Settings overlay) -->
            <Grid>
                <!-- Main View -->
                <Border BorderBrush="{StaticResource DarkerGreyBrush}" BorderThickness="1" Padding="20">
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="BLUETOOTH SOURCE"
                                   Foreground="{StaticResource DarkerGreyBrush}"
                                   FontSize="11" FontWeight="Bold"
                                   Margin="0,0,0,5"
                                   FontFamily="Consolas"/>

                    <TextBlock Text="AUDIO OUTPUT"
                               Foreground="{StaticResource DarkerGreyBrush}"
                               FontSize="11" FontWeight="Bold"
                               Margin="0,0,0,5"
                               FontFamily="Consolas"/>

                    <ComboBox Style="{StaticResource YellowComboBoxStyle}"
                              ItemsSource="{Binding OutputDevices}"
                              SelectedItem="{Binding SelectedOutputDevice}"
                              Height="45"
                              Margin="0,0,0,25">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Name}"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                    <UniformGrid Columns="2" Margin="0,0,0,20">
                        <Button Content="ENGAGE" 
                                Command="{Binding ConnectCommand}"
                                Style="{StaticResource IndustrialButtonStyle}"
                                Margin="0,0,10,0"
                                Height="50"
                                FontSize="16"/>

                        <UniformGrid Columns="2" Margin="0,0,0,20">
                            <Button Content="ENGAGE"
                                    Command="{Binding ConnectCommand}"
                                    Style="{StaticResource IndustrialButtonStyle}"
                                    Margin="0,0,10,0"
                                    Height="50"
                                    FontSize="16"/>

                            <Button Content="ABORT"
                                    Command="{Binding DisconnectCommand}"
                                    Style="{StaticResource IndustrialButtonStyle}"
                                    Margin="10,0,0,0"
                                    Height="50"
                                    FontSize="16"/>
                        </UniformGrid>

                        <!-- Status Display -->
                        <Border Background="#11FFFFFF" Padding="10" CornerRadius="2">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <Ellipse Width="8" Height="8" Margin="0,0,10,0" VerticalAlignment="Center">
                                    <Ellipse.Style>
                                        <Style TargetType="Ellipse">
                                            <Setter Property="Fill" Value="{StaticResource NeonRedBrush}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsConnected}" Value="True">
                                                    <Setter Property="Fill" Value="{StaticResource NeonGreenBrush}"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding IsBusy}" Value="True">
                                                    <Setter Property="Fill" Value="{StaticResource NeonCyanBrush}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Ellipse.Style>
                                </Ellipse>

                                <TextBlock Grid.Column="1"
                                           Text="{Binding StatusText}"
                                           Foreground="{StaticResource TextWhiteBrush}"
                                           FontFamily="Consolas"
                                           FontSize="13"
                                           VerticalAlignment="Center"/>
                            </Grid>
                        </Border>

                        <ProgressBar IsIndeterminate="True"
                                     Height="2"
                                     Margin="0,15,0,0"
                                     BorderThickness="0"
                                     Background="Transparent"
                                     Foreground="{StaticResource AcidYellowBrush}"
                                     Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                    </StackPanel>
                </Border>

                <!-- Settings Overlay -->
                <views:SettingsView
                    Visibility="{Binding IsSettingsOpen, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            </Grid>
        </DockPanel>
    </Grid>
</Window>
